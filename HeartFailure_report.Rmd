
---
title: "Heart Failure"
author: "Courtney Gale"
date: "`r format(Sys.Date(), '%Y-%m-%d')`"
output: html_document
---

This script summarizes variables from a dataset from kaggle on heart failure. More information about the dataset can be found at this website https://www.kaggle.com/andrewmvd/heart-failure-clinical-data. 

$~$


```{r, setup, include = FALSE}
knitr::opts_chunk$set(echo = FALSE, message = FALSE)
library(gt)
library(dplyr)
library(data.table)
```

```{r, importData}
# Import data directly from PLOS ONE (link pulled from Kaggle)
URL <- "https://plos.figshare.com/ndownloader/files/8937223"

# If the file has not already been downloaded to your folder
destfile <- paste0(getwd(), "/heartfailure.csv")
if (!file.exists(destfile)) {
  download.file(URL, destfile)
}

# Load CSV into R Session
data <- read.csv(destfile, header = TRUE, sep = ",")
```

```{r, clean}
# Rename columns so they are more descriptive
names(data) <- c("follow_up_days", "heart_failure", "sex", "smoker", "diabetic", "high_BP", 
	"anemic", "age", "ejection_fraction", "serum_sodium", "serum_creatinine", "platelets", 
	"creatinine_phosphokinase")

# Convert binary variables to factors so we can summarize each variable correctly
colsToFactor <- c("heart_failure", "sex", "smoker", "diabetic", "high_BP", "anemic")
data[colsToFactor] <- lapply(data[colsToFactor], factor)

```

$~$

There are `r nrow(data)` observations and `r ncol(data)` columns in this dataset.
The first 6 rows of the dataset can be observed below

$~$

```{r, rows}
data_sub <- head(data)

gt_first6 <-
  gt(data_sub) %>%
    tab_header(title = "First 6 Rows of Heart Failure Data")
  
gt_first6
```

```{r rounding-function}
good_round <- function(x, digits = 2, pval = FALSE){
    # just use round otherwise
    stopifnot(digits > 1)
    stopifnot(length(digits) == 1)
    if(pval){
        stopifnot(x >= 0 & x <= 1)
    }
    tmp <- sprintf(paste0("%.", digits, "f"), x)
    zero <- paste0("0.", paste0(rep("0", digits), collapse = ""))
    tmp[tmp == paste0("-", zero)] <- zero
    return(tmp)
}
```

$~$

The following table prints the mean for each continuous variable in our dataset by heart failure status.

```{r, continuous}
# Using dplyr get the mean of continuous variables by heart failure status
MeanBygroup <- data %>%
  group_by(heart_failure) %>%
  summarize(n = n(), follow_up_days = mean(follow_up_days), age = mean(age), EF =mean(ejection_fraction), 
            serum_sodium = mean(serum_sodium), serum_creatinine = mean(serum_creatinine), 
            platelets = mean(platelets), creatinine_phosphokinase = mean(creatinine_phosphokinase)) 

# first change heart_failure to an integer instead of factor or all variables will become factors after transposing
MeanBygroup$heart_failure <- as.integer(MeanBygroup$heart_failure)
MeanBygroup_t <- transpose(MeanBygroup)

# get row and columns in order
colnames(MeanBygroup_t) <- c("No Heart Failure", "Heart Failure")
rownames(MeanBygroup_t) <- colnames(MeanBygroup)
MeanBygroup_t <- MeanBygroup_t[-1,]
  
# Get the overall Mean of all continuous variables
OverallMean <- data %>%
  summarize(n = n(), follow_up_days = mean(follow_up_days), age = mean(age),
            EF=mean(ejection_fraction), serum_sodium = mean(serum_sodium),
            serum_creatinine = mean(serum_creatinine),  platelets = mean(platelets),
            creatinine_phosphokinase = mean(creatinine_phosphokinase))

# Transpose data
OverallMean_t <- transpose(OverallMean)

# get row and columns in order
colnames(OverallMean_t) <- "Overall"
rownames(OverallMean_t) <- colnames(OverallMean)

# Merge these two dataframes by the rownames
SummaryCont <- merge(MeanBygroup_t, OverallMean_t, by = 0, sort = FALSE)
# Give the column Row.names more descriptive names for the table
SummaryCont$Row.names <- c("N", "Follow-up Days", "Age (years)", "Ejection Fraction (%)",
                           "Serum Sodium (mEq/L)", "Serum Creatinine (mg/dL)", "Platelets (kiloplatelets/mL)",
                           "Creatinine Phosphokinase (mcg/L)")
# Rename the column Row.names, rowname so that the gt function will recognize it
colnames(SummaryCont)[1] = "rowname"

# Round data 
nameCol <- SummaryCont[1] #Need to take first column out
N <- sapply(SummaryCont[1,2:3], round, digits = 0)
WithoutName <- as.data.frame(sapply(SummaryCont[2:8, 2:3], good_round)) #Round

SummaryCont <- cbind(nameCol, rbind(N, WithoutName))


# Turn it into a table
gt_table <- 
  gt(SummaryCont) %>%
  tab_header(title = "Mean by Heart Failure Status")

gt_table
```




$~$

The following table prints summary statistics for each discrete variable in our dataset. We can see that the groups are fairly similar in the percentages of subjects who have a certain characteristic in a group. A higher percentage of subjects in the group that experienced heart failure had high blood pressure and were anemic. 

```{r, discrete}
# Summarize and print a table with summary statistics for each discrete variable
rowname = c("Male", "Smoker", "Diabetic", "High Blood Pressure", "Anemic")

dataNoHF <- data[data$heart_failure ==0,]
dataHF <- data[data$heart_failure ==1,]

# Get summary statistics for people with no heart failure
dataSummaryNoHF <- as.data.frame(rbind(summary(dataNoHF$sex), summary(dataNoHF$smoker), summary(dataNoHF$diabetic), summary(dataNoHF$high_BP), summary(dataNoHF$anemic)))

dataSummaryNoHF$`0` <- NULL

# Get percentage out of 203 (number of subjects with no heart failure)
dataSummaryNoHF$Percent <- dataSummaryNoHF$`1` / 203 * 100


# Round percentage to two decimal places
dataSummaryNoHF[2] <- sapply(dataSummaryNoHF[2], good_round)

colnames(dataSummaryNoHF) <- c("No Heart Failure 
                               (N=203)", "% of No HF")

########

# Get summary statistics for people with no heart failure
dataSummaryHF <- as.data.frame(rbind(summary(dataHF$sex), summary(dataHF$smoker), summary(dataHF$diabetic), summary(dataHF$high_BP), summary(dataHF$anemic)))

dataSummaryHF$`0` <- NULL

# Get percentage out of 96 (number of subjects with  heart failure)
dataSummaryHF$Percent <- dataSummaryHF$`1` / 96 * 100

# Round percentage to two decimal places
dataSummaryHF[2] <- sapply(dataSummaryHF[2], good_round)

colnames(dataSummaryHF) <- c("Heart Failure
                             (N=96)", "% of HF")

dataSummaryDis <- as.data.frame(cbind(rowname, dataSummaryNoHF, dataSummaryHF))

gt_discrete <- 
  gt(dataSummaryDis) %>%
  tab_header(title = "Demographics by Heart Failure Status")

gt_discrete
```
 
 $~$

<!-- 
	Names of Classmates in Breakout Room on 9/17/20
	where 0 = not present/did not say anything, 1 = present
	Weijia Qian - 1 
	Wenlu Ye - 1
	Ziyin Tang - 1
-->
